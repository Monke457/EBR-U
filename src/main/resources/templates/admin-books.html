<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<div th:replace="~{fragments/head :: head(title='Admin - Books')}"></div>
<body>

<!-- header -->
<div th:replace="~{fragments/header :: header}"></div>

<!-- content -->
<div class="content" th:switch="${formData}">

    <!-- table -->
    <div class="table-wrapper" th:case="null">
        <h4 class="sub-header">Book Management</h4>
        <a class="submit-button" th:href="@{/admin/books/add}">New Book</a>
        <table class="admin-table">
            <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Author</th>
                <th>Publication Date</th>
                <th>Synopsis</th>
                <th>Price</th>
                <th>Page Count</th>
                <th>ISBN</th>
                <th>Rating</th>
                <th>Cover</th>
                <th>Genres</th>
                <th>Edit</th>
                <th>Delete</th>
            </tr>
            <tr th:each="item : ${results}">
                <td th:text="${item.id}"></td>
                <td th:text="${item.title}"></td>
                <td th:text="${item.author.firstName} + ' ' + ${item.author.lastName}"></td>
                <td th:text="${item.publicationDate}"></td>
                <td th:text="${item.synopsis}"></td>
                <td th:text="${item.pricePerDay}"></td>
                <td th:text="${item.pageCount}"></td>
                <td th:text="${item.isbn}"></td>
                <td th:text="${item.rating}"></td>
                <td><img class="table-image" th:src="@{/books/{id}/cover(id=${item.id})}" th:alt="${item.title}"></td>
                <td th:text="${item.genres}"></td>
                <td><a class="edit-button" th:href="@{/admin/books/{id}/edit(id=${item.id})}">Edit</a></td>
                <td>
                    <form th:action="@{/admin/books/{id}/delete(id=${item.id})}" method="post">
                        <input class="delete-button" type="submit" value="Delete">
                    </form>
                </td>
            </tr>
        </table>

        <a class="submit-button" href="/admin">Back</a>
    </div>

    <!-- form -->
    <div class="section-wrapper" th:case="*">
        <h4 class="section-head" th:text="${formData.id} == 0 ? 'New Book' : 'Edit Book'"></h4>
        <form class="entity-form" th:action="${formData.id} == 0 ? @{add} : @{edit}" th:object="${formData}" enctype="multipart/form-data" method="post">
            <label>Title</label><br>
            <input type="text" th:field="*{title}"><br><br>
            <label>Publication Date</label><br>
            <input type="date" th:field="*{publicationDate}"><br><br>
            <label>Page Count</label><br>
            <input type="number" th:field="*{pageCount}"><br><br>
            <label>Synopsis</label><br>
            <textarea rows="10" cols="50" th:field="*{synopsis}"></textarea><br><br>
            <label>ISBN</label><br>
            <input type="text" th:field="*{isbn}"><br><br>
            <label>Price per day (CHF)</label><br>
            <input type="number" step="0.01" min="0" th:field="*{pricePerDay}"><br><br>
            <label>Rating</label><br>
            <input type="number" step="0.1" min="0" max="5" th:field="*{rating}"><br><br>
            <label>Author</label><br>
            <select name="author">
                <option th:each="author : ${authors}" th:text="${author.firstName} + ' ' + ${author.lastName}" th:value="${author.id}" th:selected="${formData.author} != null and ${author.id} == ${formData.author.id}"></option>
            </select><br><br>
            <label>Genres</label><br>
            <input class="checkbox-g" type="checkbox" name="genres" th:each="genre : ${genres}" th:text="${genre.name}" th:value="${genre.id}" th:checked="${formData.genres} != null and ${#lists.contains(formData.genres, genre)}"><br><br>
            <label>Cover</label><br>
            <input type="file" th:field="*{cover}"><br><br>
            <div class="button-wrapper">
                <input class="submit-button" type="submit" name="submit" value="Submit">
                <a class="submit-button" href="/admin/books">Back</a>
            </div>
        </form>
    </div>
</div>

<!-- footer -->
<div th:replace="~{fragments/footer.html :: footer}"></div>
</body>
</html>